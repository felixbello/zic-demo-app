name:  build and deploy to dev-server

on:
    pull_request_target:
        types:
            - closed
        branches:
            - 'develop'

jobs:
    deploy:
        if: github.event.pull_request.merged == true
        name: Build and Deploy
        runs-on: ubuntu-latest
        steps:
            # setup
            -   uses: actions/checkout@v3
            -   name: Set up JDK 8
                uses: actions/setup-java@v3
                with:
                    java-version: '8'
                    distribution: 'corretto'
                    cache: maven
            # cache maven dependencies
            -   name: Cache local Maven repository
                uses: actions/cache@v2
                with:
                    path: ~/.m2/repository
                    key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
                    restore-keys: |
                        ${{ runner.os }}-maven-
            # Upload artifact as product with changed backend host url
            -   name: Build and upload artifact
                run: |
                    sh scripts/change-app-title.sh "Demo App DEVELOP"
                    sh scripts/assign-app-version.sh 
                    sh scripts/build-and-upload.sh "http://tools-central-service.internal.cloud.zuken.ch:9023" "demo-app"
